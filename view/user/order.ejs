<%- include('partials/header.ejs') %>

<!--================Home Banner Area =================-->
<!-- breadcrumb start-->
<!-- <section class="breadcrumb breadcrumb_bg">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="breadcrumb_iner">
          <div class="breadcrumb_iner_item">
            <h2>Your Orders</h2>
            <p>Home <span>-</span> Your Orders</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section> -->
<!-- breadcrumb start-->

<!--================ confirmation part start =================-->
<section class="confirmation_part padding_top">
  <div class="container">
    <h2>Buyurtmalaringiz</h2>
    <div class="progress-table-wrap">
      <div class="progress-table">
        <div class="table-head">
          <div class="serial">#Buyurtma</div>
          <div class="country">Vaqt</div>
          <div class="visit">HOLAT</div>
          <div class="visit">Jami</div>
          <div class="visit">Mahsulot</div>
        </div>
        <% orders.forEach((el,index) => { %>

        <div class="table-row">
          <div class="serial"><%= index+1 %></div>
          <div class="country"><%= el.date %></div>
          <div class="visit"><%= el.orderstat %></div>
          <div class="visit"><%= el.total + 50000 %>sum</div>
          <!-- <div class="visit"> -->
          <button class="btn_3" data-toggle="modal" data-target="#myModal" onclick="modalOrderDetails('<%= el._id %>')">
            Tafsilotlar
          </button>
          <!-- </div> -->
          <div class="progress">
            <div
              class="progress-bar color-1"
              role="progressbar"
              style="width: 80%"
              aria-valuenow="80"
              aria-valuemin="0"
              aria-valuemax="100"
            ></div>
          </div>
        </div>

        <% }) %>
      </div>
    </div>
  </div>
</section>
<!--================ confirmation part end =================-->

<div class="modal" id="myModal">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Buyurtma tafsilotlari</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <div class="container px-1 px-md-4 mx-auto">
          <div class="card">
            <div class="row d-flex justify-content-between px-3 top">
              <!-- <div class="d-flex">
                <h5>ORDER <span class="text-primary font-weight-bold">#Y34XDHR</span></h5>
              </div>
              <div class="d-flex flex-column text-sm-right">
                <p class="mb-0">Expected Arrival <span>01/12/19</span></p>
                <p>USPS <span class="font-weight-bold">234094567242423422898</span></p>
              </div> -->
            </div>
            <!-- Add class 'active' to progress -->

            <div class="row d-flex justify-content-center">
              <div class="col-12">
                <ul id="progressbar" class="text-center"></ul>
              </div>
            </div>

            <div id="tracking_icon" class="row justify-content-around top">
              <div class="row d-flex icon-content">
                <img class="icon" src="https://i.imgur.com/9nnc9Et.png" />
                <div class="d-flex flex-column">
                  <p class="font-weight-bold">Buyurtma<br />Jarayonda</p>
                </div>
              </div>
              <div class="row d-flex icon-content">
                <img class="icon" src="https://i.imgur.com/u1AzR7w.png" />
                <div class="d-flex flex-column">
                  <p class="font-weight-bold">Buyurtma<br />Yuborildi</p>
                </div>
              </div>
              <div class="row d-flex icon-content">
                <img class="icon" src="https://i.imgur.com/TkPm63y.png" />
                <div class="d-flex flex-column">
                  <p class="font-weight-bold">Buyurtma<br />En Route</p>
                </div>
              </div>
              <div class="row d-flex icon-content">
                <img class="icon" src="https://i.imgur.com/HdsziHP.png" />
                <div class="d-flex flex-column">
                  <p class="font-weight-bold">Order<br />Arrived</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="container px-1" id="featured-3">
          <div class="row g-4 py-5 row-cols-1 row-cols-lg-3">
            <div class="feature col">
              <div
                class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3"
              >
                <svg class="bi" width="1em" height="1em"><use xlink:href="#collection" /></svg>
              </div>
              <h3 class="fs-2">Buyurtma tafsilotlari</h3>
              <p id="order_details">Order ID : # Date of Order : Order Current Status : Order Total : Payment Type :</p>
            </div>
            <div class="feature col">
              <div
                class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3"
              >
                <svg class="bi" width="1em" height="1em"><use xlink:href="#toggles2" /></svg>
              </div>
              <h3 class="fs-2">Etkazib berish manzili</h3>
              <p id="delivery_address">
                <iframe
                  src="https://maps.google.com/maps?q=<%= address[0].latitude %>,<%= address[0].longitude %>&hl=en&z=12&amp;output=embed"
                  width="100%"
                  height="100%"
                  frameborder="0"
                  style="border: 0"
                  allowfullscreen
                ></iframe>
              </p>
            </div>
          </div>
        </div>
        <table class="table">
          <h3>Mahsulot tafsilotlari</h3>
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>Sarlavha</th>
              <th>Miqdori</th>
              <th>Jami</th>
            </tr>
          </thead>
          <tbody id="table_body12"></tbody>
        </table>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <a type="button" class="btn btn-danger mr-auto text-white" id="cancel_order">Buyurtmani bekor qilish</a>
        <button class="btn btn-danger" data-dismiss="modal">Yopish</button>
      </div>
    </div>
  </div>
</div>

<style>
  body {
    color: #000;
    overflow-x: hidden;
    height: 100%;
    background-repeat: no-repeat;
  }

  .card {
    z-index: 0;
    background-color: #eceff1;
    padding-bottom: 20px;
    margin-top: 5px;
    border-radius: 10px;
  }

  .top {
    padding-top: 40px;
    padding-left: 13% !important;
    padding-right: 13% !important;
  }

  /*Icon progressbar*/
  #progressbar {
    margin-bottom: 30px;
    overflow: hidden;
    color: #455a64;
    padding-left: 0px;
    margin-top: 30px;
  }

  #progressbar li {
    list-style-type: none;
    font-size: 13px;
    width: 25%;
    float: left;
    position: relative;
    font-weight: 400;
  }

  #progressbar .step0:before {
    font-family: FontAwesome;
    content: '\f10c';
    color: #fff;
  }

  #progressbar li:before {
    width: 40px;
    height: 40px;
    line-height: 45px;
    display: block;
    font-size: 20px;
    background: #c5cae9;
    border-radius: 50%;
    margin: auto;
    padding: 0px;
  }

  /*ProgressBar connectors*/
  #progressbar li:after {
    content: '';
    width: 100%;
    height: 12px;
    background: #c5cae9;
    position: absolute;
    left: 0;
    top: 16px;
    z-index: -1;
  }

  #progressbar li:last-child:after {
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
    position: absolute;
    left: -50%;
  }

  #progressbar li:nth-child(2):after,
  #progressbar li:nth-child(3):after {
    left: -50%;
  }

  #progressbar li:first-child:after {
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
    position: absolute;
    left: 50%;
  }

  #progressbar li:last-child:after {
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
  }

  #progressbar li:first-child:after {
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
  }

  /*Color number of the step and the connector before it*/
  #progressbar li.active:before,
  #progressbar li.active:after {
    background: #651fff;
  }

  #progressbar li.active:before {
    font-family: FontAwesome;
    content: '\f00c';
  }

  .icon {
    width: 60px;
    height: 60px;
    margin-right: 15px;
  }

  .icon-content {
    padding-bottom: 20px;
  }

  @media screen and (max-width: 992px) {
    .icon-content {
      width: 50%;
    }
  }
</style>

<script src="https://kit.fontawesome.com/b02fd68529.js" crossorigin="anonymous"></script>
<script>
  function modalOrderDetails(id) {
    $.ajax({
      url: '/orders',
      method: 'POST',
      data: {
        orderId: id,
      },
    }).then((response) => {
      let order = response.order;

      let table_data = '';
      $.each(order.products, function (index, value) {
        /*console.log(value);*/
        table_data += '<tr>';
        table_data += '<td>' + (index + 1) + '</td>';
        table_data += '<td>' + value.product.title + '</td>';
        table_data += '<td>' + value.quantity + '</td>';
        table_data += '<td>' + (value.subtotal) + 'sum</td>';
        table_data += '<tr>';
      });
      // $('tbody').append(table_data);
      $('#table_body12').html(table_data);

      if (order.orderstat === 'CONFIRMED') {
        var tracking_stat =
          '<li class="active step0"></li><li class="step0"></li><li class="step0"></li><li class="step0"></li>';
        var tracking_icon = `            <div class="row d-flex icon-content">
              <img class="icon" src="https://i.imgur.com/9nnc9Et.png" />
              <div class="d-flex flex-column">
                <p class="font-weight-bold">Buyurtma<br />Jarayonda</p>
              </div>
            </div>`;
      } else if (order.orderstat === 'SHIPPED') {
        var tracking_stat =
          '<li class="active step0"></li><li class="active step0"></li><li class="step0"></li><li class="step0"></li>';
        var tracking_icon = `            <div class="row d-flex icon-content">
              <img class="icon" src="https://i.imgur.com/u1AzR7w.png" />
              <div class="d-flex flex-column">
                <p class="font-weight-bold">Buyurtma<br />Yuborildi</p>
              </div>
            </div>`;
      } else if (order.orderstat === 'OUT FOR DELIVERY') {
        var tracking_stat =
          '<li class="active step0"></li><li class="active step0"></li><li class="active step0"></li><li class="step0"></li>';
        var tracking_icon = `<div class="row d-flex icon-content">
              <img class="icon" src="https://i.imgur.com/TkPm63y.png" />
              <div class="d-flex flex-column">
                <p class="font-weight-bold">Buyurtma<br />Joylandi</p>
              </div>
            </div>`;
      } else if (order.orderstat === 'DELIVERED') {
        var tracking_stat =
          '<li class="active step0"></li><li class="active step0"></li><li class="active step0"></li><li class="active step0"></li>';
        var tracking_icon = `<div class="row d-flex icon-content">
              <img class="icon" src="https://i.imgur.com/HdsziHP.png" />
              <div class="d-flex flex-column">
                <p class="font-weight-bold">Buyurtma<br />Yetib keldi</p>
              </div>
            </div>`;
      } else {
        var tracking_stat = '<li> Buyurtma bekor qilindi</li>';
        var tracking_icon = `<div class="row d-flex icon-content">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>

              <div class="d-flex flex-column">
                <p class="font-weight-bold">Buyurtma<br />Bekor qilingan</p>
              </div>
            </div>`;
      }
      $('#progressbar').empty().append(tracking_stat);
      $('#tracking_icon').empty().append(tracking_icon);
      let order_details = ` 
                Buyurtma ID : #<span class="font-weight-bold">${order._id}</span><br>
                Buyurtma sanasi :<span class="font-weight-bold">${order.date}</span><br>
                Buyurtmaning joriy holati :<span class="font-weight-bold">${order.orderstat}</span><br>
                Buyurtma Narxi :<span class="font-weight-bold">${order.total+50000}</span><br>
                To'lov turi :<span class="font-weight-bold">${order.payment}</span><br>
                `;
      $('#order_details').empty().append(order_details);
      // $('#delivery_address').empty().append(delivery_address);
      $('#cancel_order').click(() => {
        warningAlert(order._id);
      });
    });
  }
</script>

<%- include('partials/footer.ejs') %>
